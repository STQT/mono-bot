# Mona - Telegram Bot + Django Admin Panel

Проект представляет собой Telegram бота на основе aiogram и Django админ-панель для управления системой QR-кодов, баллов и подарков.

## Технологический стек

- **Python 3.11**
- **Django 5.0** (async support)
- **aiogram 3.3** (Telegram Bot Framework)
- **PostgreSQL** (SQL база данных)
- **MongoDB** (NoSQL база данных - для будущего расширения)
- **Redis** (кэширование и Channels)
- **Docker & Docker Compose**

## Основной функционал

### Telegram Bot
- Регистрация пользователей (электрики и продавцы) с телефоном и локацией
- Сканирование QR-кодов через команду `/start <qr_code>` (с ограничением в 3 попытки)
- Начисление баллов за QR-коды:
  - Электрики: 50 баллов за QR-код
  - Продавцы: 20 баллов за QR-код
- Просмотр доступных подарков и их получение
- Просмотр баланса и ТОП лидеров

### Django Admin Panel
- **Генерация QR-кодов**: массовая генерация QR-кодов для продавцов (D-) и электриков (E-) с возможностью скачать ZIP архив
- **Просмотр QR-кодов**: список всех QR-кодов с маскировкой части кода, датами генерации/сканирования и информацией о пользователе
- **Управление подарками**: создание и редактирование подарков с изображениями и стоимостью в баллах
- **CRM для подарков**: обработка запросов на получение подарков (одобрение/отклонение)
- **Управление пользователями**: просмотр пользователей с их баллами
- **Дашборд**: ТОП лидеры по продажам (отдельно для электриков и продавцов), общая статистика

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd mona
```

### 2. Настройка окружения
Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

Отредактируйте `.env` и обязательно укажите:
- `SECRET_KEY` - секретный ключ Django (можно сгенерировать через Django: `python manage.py shell -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"`)
- `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота (получите у @BotFather в Telegram)
- Параметры баз данных (по умолчанию настроены для Docker Compose)

### 3. Запуск через Docker Compose
```bash
docker-compose up -d
```

### 4. Применение миграций
```bash
docker-compose exec web python manage.py migrate
```

### 5. Создание суперпользователя
```bash
docker-compose exec web python manage.py createsuperuser
```

### 6. Запуск бота
Бот запускается автоматически при старте Django приложения через `bot/apps.py`.

## Использование

### Доступ к админ-панели
Откройте в браузере: `http://localhost:8000/admin/`

### Генерация QR-кодов
1. Перейдите в раздел "QR-коды" в админ-панели
2. Нажмите на кнопку "Генерация QR-кодов" (или перейдите по ссылке в админке)
3. Выберите тип (Электрик или Продавец) и количество
4. После генерации скачайте ZIP архив с изображениями

### Использование бота
1. Найдите вашего бота в Telegram
2. Отправьте команду `/start`
3. Пройдите регистрацию (номер телефона + локация)
4. Используйте QR-код: `/start <qr_code>`
5. Просматривайте подарки и обменивайте баллы

## Структура проекта

```
mona/
├── bot/                 # Telegram бот (aiogram)
│   ├── bot.py          # Основная логика бота
│   └── apps.py         # Конфигурация приложения
├── core/                # Основное приложение Django
│   ├── models.py       # Модели данных
│   ├── admin.py        # Админ-панель
│   ├── views.py        # API views
│   ├── serializers.py  # DRF serializers
│   └── utils.py        # Утилиты (генерация QR)
├── mona/               # Настройки Django проекта
│   ├── settings.py    # Конфигурация
│   ├── urls.py        # URL routing
│   └── asgi.py        # ASGI конфигурация
├── templates/          # HTML шаблоны
│   └── admin/         # Шаблоны админки
├── docker-compose.yml  # Docker Compose конфигурация
├── Dockerfile          # Docker образ
└── requirements.txt    # Python зависимости
```

## Модели данных

- **TelegramUser**: Пользователи Telegram (электрики/продавцы)
- **QRCode**: QR-коды (скретч-карты)
- **QRCodeScanAttempt**: Попытки сканирования QR-кодов
- **Gift**: Подарки
- **GiftRedemption**: Запросы на получение подарков

## API Endpoints

- `GET /api/users/` - Список пользователей
- `GET /api/users/leaders/` - ТОП лидеры
- `GET /api/qrcodes/` - Список QR-кодов
- `GET /api/gifts/` - Список подарков

## Разработка

Проект написан с учетом лучших практик:
- Чистый код с комментариями
- Разделение ответственности
- Готовность к расширению функционала
- Использование async/await где возможно

## Лицензия

MIT

